<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=400, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Datos Tarjeta - Bahia Chill</title>
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap" rel="stylesheet">
  <style>
    body {
      min-height: 100vh;
      margin: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Roboto', Arial, sans-serif;
      background: linear-gradient(135deg, #3d819d 0%, #25647a 50%, #13394a 100%);
      overflow: hidden;
    }
  </style>
</head>
<body>
  <button id="btn-volver" style="position:fixed;top:18px;left:18px;z-index:1002;background:rgba(0,0,0,0.18);border:none;border-radius:50%;width:44px;height:44px;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 8px 0 rgba(0,0,0,0.13);cursor:pointer;outline:none;">
    <span style="color:#fff;font-size:1.5em;font-weight:bold;">⟵</span>
  </button>
  <button id="viewCardDetailsButton" style="position:fixed;bottom:32px;left:50%;transform:translateX(-50%);z-index:1002;background:#25647a;color:#fff;border:none;border-radius:22px;padding:12px 32px;font-size:1.1em;font-weight:bold;box-shadow:0 2px 8px 0 rgba(0,0,0,0.13);cursor:pointer;outline:none;">Ver Detalles de Tarjeta</button>
  <div id="cardDetailContainer" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:2000;align-items:center;justify-content:center;">
    <div id="overlayBackground" aria-hidden="true" style="position:absolute;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);opacity:0;pointer-events:none;transition:opacity 0.3s ease-in-out;"></div>
    <div id="invoiceSlot" style="position:absolute;top:20vh;left:50%;transform:translateX(-50%);width:40vw;max-width:320px;height:6px;background:#333;border-radius:3px;z-index:2;"></div>
    <div id="invoicePaper" style="position:absolute;top:calc(20vh + 3px);left:50%;transform:translateX(-50%) translateY(300px);width:80vw;max-width:350px;height:0;background:#fff;border-radius:12px;box-shadow:0 8px 32px 0 rgba(0,0,0,0.18);opacity:0;overflow:hidden;z-index:3;transition:height 0.8s cubic-bezier(.4,2,.3,1), opacity 0.3s, transform 0.8s cubic-bezier(.4,2,.3,1);display:flex;flex-direction:column;align-items:center;">
      <div id="invoiceContent" style="opacity:0;transform:translateY(40px);transition:opacity 0.4s 0.4s, transform 0.4s 0.4s;display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;height:100%;padding:32px 18px 18px 18px;box-sizing:border-box;">
        <h2 style="color:#25647a;font-size:1.3em;margin-bottom:18px;">Datos de Tarjeta</h2>
        <div style="width:100%;text-align:left;margin-bottom:12px;"><b>Nombre:</b> <span id="detalleNombre">Juan</span></div>
        <div style="width:100%;text-align:left;margin-bottom:12px;"><b>Documento:</b> <span id="detalleDocumento">******2272</span></div>
        <div style="width:100%;text-align:left;margin-bottom:12px;"><b>Fecha de Vencimiento:</b> <span id="detalleVencimiento">30/06/2025</span></div>
        <button id="closeInvoiceButton" style="margin-top:24px;background:#25647a;color:#fff;border:none;border-radius:18px;padding:10px 28px;font-size:1em;font-weight:bold;box-shadow:0 2px 8px 0 rgba(0,0,0,0.13);cursor:pointer;outline:none;">Cerrar</button>
      </div>
    </div>
  </div>
  <script>
    // Redirigir a datos_tarjeta.html con los datos del usuario
    document.getElementById('btn-volver').addEventListener('click', function() {
      // Obtener datos del usuario actual de localStorage
      const nombre = localStorage.getItem('currentUser') || '';
      // Aquí podrías obtener el documento y vencimiento de Supabase si lo deseas
      // Para ejemplo simple, solo pasamos el nombre por query string
      window.location.href = `datos_tarjeta.html?nombre=${encodeURIComponent(nombre)}`;
    });

    // Obtener datos desde query string si existen
    function getQueryParam(param) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param);
    }
    const nombreQS = getQueryParam('nombre');
    if (nombreQS) {
      document.getElementById('detalleNombre').textContent = nombreQS;
    }

    // Datos de ejemplo (reemplazar por datos reales de backend/API)
    const nombre = 'Juan';
    const documento = '1019602272';
    const fechaVencimiento = '30/06/2025';
    // Enmascarar documento
    function maskDoc(doc) {
      return '******' + doc.slice(-4);
    }
    // Formatear fecha
    function formatFecha(fecha) {
      if (fecha.includes('/')) return fecha;
      const [a, m, d] = fecha.split('-');
      return `${d}/${m}/${a}`;
    }
    // Inyectar datos
    document.getElementById('detalleNombre').textContent = nombre;
    document.getElementById('detalleDocumento').textContent = maskDoc(documento);
    document.getElementById('detalleVencimiento').textContent = formatFecha(fechaVencimiento);

    // Animación y lógica de apertura/cierre
    const viewBtn = document.getElementById('viewCardDetailsButton');
    const container = document.getElementById('cardDetailContainer');
    const overlay = document.getElementById('overlayBackground');
    const paper = document.getElementById('invoicePaper');
    const content = document.getElementById('invoiceContent');
    const closeBtn = document.getElementById('closeInvoiceButton');
    let animTimeout1, animTimeout2;

    function openInvoice() {
      container.style.display = 'flex';
      setTimeout(() => {
        overlay.style.opacity = '0.7';
        overlay.style.pointerEvents = 'auto';
      }, 10);
      setTimeout(() => {
        paper.style.height = '420px';
        paper.style.opacity = '1';
        paper.style.transform = 'translateX(-50%) translateY(0)';
        setTimeout(() => {
          content.style.opacity = '1';
          content.style.transform = 'translateY(0)';
        }, 400);
      }, 100);
      // Sonido sutil (opcional)
      try {
        const audio = new Audio('https://cdn.pixabay.com/audio/2022/07/26/audio_124bfae5b2.mp3');
        audio.volume = 0.08;
        audio.play();
      } catch(e){}
    }
    function closeInvoice() {
      content.style.opacity = '0';
      content.style.transform = 'translateY(40px)';
      paper.style.opacity = '0';
      paper.style.transform = 'translateX(-50%) translateY(20px)';
      setTimeout(() => {
        paper.style.height = '0';
        overlay.style.opacity = '0';
        overlay.style.pointerEvents = 'none';
      }, 300);
      setTimeout(() => {
        container.style.display = 'none';
      }, 650);
    }
    viewBtn.addEventListener('click', openInvoice);
    closeBtn.addEventListener('click', closeInvoice);
    overlay.addEventListener('click', closeInvoice);
    // Accesibilidad
    overlay.setAttribute('role', 'presentation');
    overlay.addEventListener('click', closeInvoice);
    // Accesibilidad
    overlay.setAttribute('role', 'presentation');
    overlay.setAttribute('aria-hidden', 'true');
    paper.setAttribute('role', 'dialog');
    paper.setAttribute('aria-modal', 'true');
    paper.setAttribute('aria-labelledby', 'detalleNombre');
  </script></body></html>

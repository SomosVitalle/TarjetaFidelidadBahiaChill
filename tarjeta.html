<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bahía Chill - Tarjeta VIP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Roboto:wght@300;400&display=swap');
        
        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #3d819d 0%, #25647a 50%, #13394a 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            perspective: 1000px;
        }
        
        .card-container {
            width: 427.5px;
            height: 217.5px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 1s;
            cursor: pointer;
            filter: drop-shadow(0 0 10px rgba(0, 195, 255, 0.3));
        }
        
        .card-container.flipped {
            transform: rotateY(180deg);
        }
        
        .card {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 15px;
            background: linear-gradient(135deg, rgba(61, 129, 157, 0.18) 0%, rgba(61, 129, 157, 0.08) 100%);
            backdrop-filter: blur(16px) saturate(180%);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 15px;
            display: flex;
            flex-direction: column;
            color: white;
            overflow: hidden;
        }
        
        .card::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            /* Gradiente prisma arcoíris */
            background: linear-gradient(90deg,
                rgba(255,0,102,0.0) 0%,
                rgba(255,0,102,0.5) 10%,
                rgba(255,154,0,0.5) 25%,
                rgba(208,222,33,0.5) 40%,
                rgba(79,220,74,0.5) 55%,
                rgba(63,218,216,0.5) 70%,
                rgba(47,201,226,0.5) 80%,
                rgba(28,127,238,0.5) 90%,
                rgba(95,21,242,0.5) 100%,
                rgba(255,0,102,0.0) 100%
            );
            transition: none;
        }
        
        .card-container.flipped .card::after {
            animation: shine 1s ease-out;
        }
        
        @keyframes shine {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .card-back {
            transform: rotateY(180deg);
            background: linear-gradient(135deg, rgba(61, 129, 157, 0.18) 0%, rgba(61, 129, 157, 0.08) 100%);
            backdrop-filter: blur(16px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .palm-logo {
            position: absolute;
            top: 7.5px;
            left: 7.5px;
            opacity: 0.7;
            font-size: 21px;
        }
        
        .title {
            font-family: 'Playfair Display', serif;
            text-align: center;
            font-size: 18px;
            margin-top: 7.5px;
            letter-spacing: 2px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .stamps {
            display: flex;
            justify-content: space-around;
            margin: 11.25px 0;
        }
        
        .stamp {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .stamp i {
            font-size: 12px;
            opacity: 0.7;
        }
        
        .qr-code {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 30px;
            opacity: 0.3;
        }
        
        .qr-code-back {
            opacity: 0.8;
            background: rgba(255, 255, 255, 0.2);
        }
        
        .footer {
            text-align: center;
            font-size: 9px;
            margin-top: auto;
            opacity: 0.9;
        }
        
        .highlight {
            font-family: 'Playfair Display', serif;
            font-size: 10.5px;
            font-weight: bold;
            color: white;
        }
        
        .stamps-back {
            transform: scaleX(-1);
        }
        
        .stamp-back {
            transform: scaleX(-1);
            opacity: 0.5;
        }

        .shine-reset {
            animation: none !important;
        }

        /* Efectos de nitidez y blur según la cara visible */
        .card .sharp {
            filter: none;
            transition: filter 0.4s;
        }
        .card .blurred {
            filter: blur(2px);
            transition: filter 0.4s;
        }
        .card-back .sharp {
            filter: none;
            transition: filter 0.4s;
        }
        .card-back .blurred {
            filter: blur(2px);
            transition: filter 0.4s;
        }

        /* Ajuste para el logo superior */
        .palm-logo img {
            width: 38px;
            height: 38px;
            object-fit: contain;
            opacity: 0.7;
        }
        /* Ajuste para los logos dentro de los círculos */
        .stamp img {
            width: 26.25px;
            height: 26.25px;
            object-fit: contain;
            opacity: 0.7;
        }

        /* FAQ MODAL: fuerza visibilidad y z-index */
        #faq-modal {
            display: none;
            position: fixed;
            z-index: 9999 !important;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.35);
            backdrop-filter: blur(2px);
            justify-content: center;
            align-items: center;
        }
        #faq-modal[aria-visible="true"] {
            display: flex !important;
        }
        #faq-modal > div {
            background: linear-gradient(135deg,#3d819d 0%,#25647a 100%);
            border-radius: 18px;
            box-shadow: 0 8px 32px 0 rgba(0,0,0,0.25);
            padding: 32px 20px 24px 20px;
            max-width: 370px;
            width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .question-circle {
            position: absolute !important;
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%,-50%) scaleX(-1) !important;
            width: 80px !important;
            height: 80px !important;
            display: flex !important;
            justify-content: center !important;
            align-items: center !important;
            background: rgba(255,255,255,0.10) !important;
            box-shadow: 0 0 8px 1px rgba(0,0,0,0.10) !important;
            border-radius: 50% !important;
            border: 2px solid #fff !important;
            cursor: pointer !important;
            z-index: 10 !important;
        }
        .question-circle i {
            color: #fff !important;
            opacity: 0.95 !important;
            font-size: 60px !important;
        }
    </style>
</head>
<body style="display:none;" id="body-block">
    <div class="card-container" id="card">
        <!-- Front of the card -->
        <div class="card">
            <div class="palm-logo sharp" id="front-logo">
                <img src="Variantes/palma_blanca_sin_fondo.jpg.png" alt="Logo Bahía Chill" />
            </div>
            <div class="title sharp" id="front-title">BAHIA CHILL</div>
            <div class="stamps" id="stamps-row-1"></div>
            <div class="stamps" id="stamps-row-2"></div>
            <div class="footer sharp" id="front-footer">
                SOLO TE FALTAN <span class="highlight">3 PALMAS</span> PARA RECLAMAR TU REGALO
            </div>
        </div>
        <!-- Back of the card -->
        <div class="card card-back">
            <div class="palm-logo blurred" id="back-logo" style="opacity: 0.3; transform: scaleX(-1); right: 10px; left: auto;">
                <img src="Variantes/palma_blanca_sin_fondo.jpg.png" alt="Logo Bahía Chill" />
            </div>
            <div class="title blurred" id="back-title" style="transform: scaleX(-1);">BAHIA CHILL</div>
            <div class="stamps stamps-back">
                <div class="stamp blurred"><img src="Variantes/palma_blanca_sin_fondo.jpg.png" alt="Logo Bahía Chill" /></div>
                <div class="stamp blurred"><img src="Variantes/palma_blanca_sin_fondo.jpg.png" alt="Logo Bahía Chill" /></div>
                <div class="stamp blurred"><img src="Variantes/palma_blanca_sin_fondo.jpg.png" alt="Logo Bahía Chill" /></div>
                <div class="stamp blurred"><img src="Variantes/palma_blanca_sin_fondo.jpg.png" alt="Logo Bahía Chill" /></div>
                <div class="stamp blurred"><img src="Variantes/palma_blanca_sin_fondo.jpg.png" alt="Logo Bahía Chill" /></div>
            </div>
            <!-- Signo de pregunta centrado -->
            <div class="question-circle sharp" id="back-question" style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) scaleX(-1);width:80px;height:80px;display:flex;justify-content:center;align-items:center;background:rgba(255,255,255,0.10);box-shadow:0 0 8px 1px rgba(0,0,0,0.10);border-radius:50%;border:2px solid #fff;cursor:pointer;z-index:2;">
                <i class="fa-solid fa-question" style="color:#fff;opacity:0.95;font-size:60px;"></i>
            </div>
            <div class="stamps stamps-back" style="margin-top: 10px;">
                <div class="stamp blurred"><img src="Variantes/palma_blanca_sin_fondo.jpg.png" alt="Logo Bahía Chill" /></div>
                <div class="stamp blurred"><img src="Variantes/palma_blanca_sin_fondo.jpg.png" alt="Logo Bahía Chill" /></div>
                <div class="stamp blurred"><img src="Variantes/palma_blanca_sin_fondo.jpg.png" alt="Logo Bahía Chill" /></div>
                <div class="stamp blurred"><img src="Variantes/palma_blanca_sin_fondo.jpg.png" alt="Logo Bahía Chill" /></div>
                <div class="stamp blurred"><img src="Variantes/palma_blanca_sin_fondo.jpg.png" alt="Logo Bahía Chill" /></div>
            </div>
            <div class="footer blurred" id="back-footer" style="transform: scaleX(-1);">
                SOLO TE FALTAN <span class="highlight">3 PALMAS</span> PARA RECLAMAR TU REGALO
            </div>
        </div>
    </div>
    <!-- MODAL FAQ -->
    <div id="faq-modal" aria-visible="false">
      <div>
        <div style="width:100%;display:flex;justify-content:flex-end;margin-bottom:8px;">
          <button id="faq-close" style="background:none;border:none;color:#fff;font-size:28px;cursor:pointer;line-height:1;opacity:0.8;">&times;</button>
        </div>
        <div style="text-align:center;font-weight:bold;font-size:1.25rem;margin-bottom:18px;">Preguntas frecuentes</div>
        <div style="width:100%;margin-bottom:16px;">
          <div style="font-weight:bold;margin-bottom:4px;">¿A que tengo acceso con mi Tarjeta Blue Pass?</div>
          <div style="margin-bottom:12px;">Tienes derecho a un beneficio exclusivo para nuestros unicos 200 usuarios, cada mes cambia. Pueden ser regalos en bebidas de diferentes categorias, regalos sorpresa o descuentos. Revisa nuestras redes <a href="https://www.instagram.com/bahia.chill.bar/" target="_blank" style="color:#60aaff;text-decoration:underline;font-weight:500;">@bahia.chill.bar</a> para saber a que tienes acceso este mes.</div>
          <div style="font-weight:bold;margin-bottom:4px;">Un amigo (o familia) quiere tener su propia tarjeta, ¿Cómo lo puede hacer?</div>
          <div style="margin-bottom:12px;">Muy facil, al final de esta informacion verás un boton de contacto, al hacer click te llevara con nuestros auxiliares de Tarjeta y puedes <b>escribirles tu</b> los datos que te solicitan o <b>compartirle el numero</b> a la persona interesada para que ellos mismo hagan su aplicación.</div>
          <div style="font-weight:bold;margin-bottom:4px;">¿Puedo prestarle mi tarjeta a alguien?</div>
          <div style="margin-bottom:12px;">No, todos nuestros usuarios aceptaron que su tarjeta sea unica e intraferible. Al momento de solicitar un sticker o de querer reclamar un regalo debera hacerlo el dueño de la tarjeta.</div>
        </div>
        <div style="text-align:center;font-weight:bold;margin-bottom:10px;">¿Tienes más preguntas?, nuestro equipo esta listo para reponder a todas tus inquietudes</div>
        <a href="https://wa.link/l0zt0d" target="_blank" style="display:flex;align-items:center;justify-content:center;background:#25d366;border-radius:50px;padding:10px 22px;color:#fff;font-weight:bold;font-size:1.1rem;text-decoration:none;gap:10px;box-shadow:0 2px 8px 0 rgba(0,0,0,0.10);transition:background 0.2s;">
          <i class="fa-brands fa-whatsapp" style="font-size:1.5rem;"></i> Contactar por WhatsApp
        </a>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
      // Inicialización global de Supabase
      const SUPABASE_URL = 'https://senqhfrzhsvrwiqschuf.supabase.co';
      const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNlbnFoZnJ6aHN2cndpcXNjaHVmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAxMTA3MzksImV4cCI6MjA2NTY4NjczOX0.SoQUuDrUtIObkHMTn6HOOR74MvYTI5bgy4-PDU4p-dg';
      const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

      // Verifica login y existencia de usuario en Supabase
      async function checkAndRedirect() {
        if (localStorage.getItem('bahiaChillLogin') !== 'ok' || !localStorage.getItem('currentUser')) {
          window.location.href = 'index.html';
          return false;
        }
        const currentUser = localStorage.getItem('currentUser');
        // Si es Bahiachill, redirige a panel de control
        if (currentUser && currentUser.toLowerCase() === 'bahiachill') {
          window.location.href = 'panel_de_control.html';
          return false;
        }
        const { data, error } = await supabase.from('usuarios').select('username').eq('username', currentUser);
        if (error || !data || data.length === 0) {
          window.location.href = 'index.html';
          return false;
        }
        return true;
      }

      // Obtiene datos del usuario actual
      async function getUserSupabase(username) {
        const { data, error } = await supabase.from('usuarios').select('*').eq('username', username).maybeSingle();
        if (error) return null;
        return data;
      }

      // Renderiza los stickers según el campo numero
      async function renderStickers() {
        const username = localStorage.getItem('currentUser');
        const user = await getUserSupabase(username);
        let numero = 0;
        if (user && typeof user.numero === 'number' && user.numero >= 0 && user.numero <= 10) {
          numero = user.numero;
        }
        // Orden personalizado: 1 3 5 7 9 2 4 6 8 10 (índices base 0)
        const orden = [0,2,4,6,8,1,3,5,7,9];
        const logoSrc = 'Variantes/palma_blanca_sin_fondo.jpg.png';
        const stickers = [];
        for (let i = 0; i < 10; i++) {
          if (i < numero) {
            stickers.push(`<div class='stamp sharp'><img src='${logoSrc}' alt='Logo Bahía Chill' /></div>`);
          } else {
            stickers.push(`<div class='stamp sharp' style='background:rgba(255,255,255,0.08);border:1px dashed #fff;'><i class='fa-regular fa-circle' style='color:#fff;opacity:0.3;font-size:22px;'></i></div>`);
          }
        }
        const stickersOrdenados = orden.map(idx => stickers[idx]);
        document.getElementById('stamps-row-1').innerHTML = stickersOrdenados.slice(0,5).join('');
        document.getElementById('stamps-row-2').innerHTML = stickersOrdenados.slice(5,10).join('');
        // Actualizar texto de footer
        const faltan = 10 - numero;
        document.getElementById('front-footer').innerHTML = `SOLO TE FALTAN <span class="highlight">${faltan} PALMAS</span> PARA RECLAMAR TU REGALO`;
      }

      // Redirigir a login tras 5 minutos
      setTimeout(function() {
        window.location.href = 'index.html';
      }, 5 * 60 * 1000);

      // Lógica de la tarjeta y giro (sin QR)
      function setupCardUI() {
        const card = document.getElementById('card');
        let modalOpen = false;
        function handleCardClick(e) {
          if (modalOpen) return;
          card.classList.toggle('flipped');
          const cards = card.querySelectorAll('.card');
          cards.forEach(cardEl => {
            cardEl.classList.remove('shine-reset');
            void cardEl.offsetWidth;
            cardEl.classList.add('shine-reset');
          });
          const isFlipped = card.classList.contains('flipped');
          document.querySelectorAll('.card .sharp').forEach(el => {
            el.style.filter = isFlipped ? 'blur(2px)' : 'none';
          });
          document.querySelectorAll('.card .blurred').forEach(el => {
            el.style.filter = isFlipped ? 'none' : 'blur(2px)';
          });
          document.querySelectorAll('.card-back .sharp').forEach(el => {
            el.style.filter = isFlipped ? 'none' : 'blur(2px)';
          });
          document.querySelectorAll('.card-back .blurred').forEach(el => {
            el.style.filter = isFlipped ? 'blur(2px)' : 'none';
          });
        }
        card.removeEventListener('click', handleCardClick);
        card.addEventListener('click', handleCardClick);
        // FAQ Modal logic
        const faqModal = document.getElementById('faq-modal');
        const faqClose = document.getElementById('faq-close');
        const questionBtn = document.getElementById('back-question');
        if (questionBtn) {
          questionBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            faqModal.setAttribute('aria-visible', 'true');
            faqModal.style.display = 'flex';
            modalOpen = true;
          });
        }
        if (faqClose) {
          faqClose.addEventListener('click', function(e) {
            e.stopPropagation();
            faqModal.setAttribute('aria-visible', 'false');
            faqModal.style.display = 'none';
            modalOpen = false;
          });
        }
        faqModal.addEventListener('click', function(e) {
          if (e.target === faqModal) {
            faqModal.setAttribute('aria-visible', 'false');
            faqModal.style.display = 'none';
            modalOpen = false;
          }
        });
        // Evita que el click en el signo de pregunta gire la tarjeta
        if (questionBtn) {
          questionBtn.addEventListener('mousedown', function(e) { e.stopPropagation(); });
        }
        window.addEventListener('DOMContentLoaded', () => {
          document.querySelectorAll('.card .sharp').forEach(el => {
            el.style.filter = 'none';
          });
          document.querySelectorAll('.card .blurred').forEach(el => {
            el.style.filter = 'blur(2px)';
          });
          document.querySelectorAll('.card-back .sharp').forEach(el => {
            el.style.filter = 'blur(2px)';
          });
          document.querySelectorAll('.card-back .blurred').forEach(el => {
            el.style.filter = 'none';
          });
        });
      }

      // Secuencia principal: check login, render UI
      window.addEventListener('DOMContentLoaded', async function() {
        const ok = await checkAndRedirect();
        if (!ok) return;
        document.getElementById('body-block').style.display = '';
        await renderStickers();
        setupCardUI();
      });
    </script>
</body>
</html>
